# Telegram Blocker Bot

Telegram бот для автоматической блокировки пользователей, отписавшихся от вашего канала.

## Описание

Этот бот специально разработан для **Telegram каналов** (не путать с группами). Он отслеживает подписчиков канала и автоматически блокирует тех, кто отписался. Это полезно для предотвращения повторной подписки пользователей, которые покинули ваш канал.

**Важно:** Этот бот работает именно для каналов, где пользователи подписываются и читают публикации, а не для групп, где участники общаются друг с другом.

## Возможности

- Автоматическое отслеживание отписок от канала
- Мгновенная блокировка пользователей при отписке
- Подробное логирование всех действий
- Игнорирование ботов
- Простая настройка через переменные окружения

## Требования

- Python 3.8 или выше
- Telegram Bot Token (от [@BotFather](https://t.me/BotFather))
- Права администратора для бота в канале

## Установка

### 1. Клонируйте репозиторий

```bash
git clone <your-repo-url>
cd telegram-blocker-bot
```

### 2. Создайте виртуальное окружение (рекомендуется)

```bash
python3 -m venv venv
source venv/bin/activate  # На Windows: venv\Scripts\activate
```

### 3. Установите зависимости

```bash
pip install -r requirements.txt
```

### 4. Настройте переменные окружения

Скопируйте `.env.example` в `.env`:

```bash
cp .env.example .env
```

Отредактируйте файл `.env` и укажите ваши данные:

```env
BOT_TOKEN=your_bot_token_here
CHANNEL_ID=-100123456789
```

## Настройка бота

### Шаг 1: Создайте бота

1. Откройте [@BotFather](https://t.me/BotFather) в Telegram
2. Отправьте команду `/newbot`
3. Следуйте инструкциям для создания бота
4. Скопируйте полученный токен в `.env` файл

### Шаг 2: Узнайте ID канала

#### Способ 1: Через веб-интерфейс

1. Откройте ваш канал в веб-версии Telegram (web.telegram.org)
2. ID канала будет в URL: `https://web.telegram.org/k/#-1001234567890`
3. Используйте это число (с минусом) в `.env`

#### Способ 2: Через бота

1. Добавьте [@userinfobot](https://t.me/userinfobot) в ваш канал
2. Перешлите любое сообщение из канала боту
3. Бот покажет ID канала
4. Удалите @userinfobot из канала после получения ID

### Шаг 3: Добавьте бота в канал

1. Откройте ваш канал
2. Нажмите на название канала → "Administrators" → "Add Administrator"
3. Найдите вашего бота и добавьте его
4. **ВАЖНО:** Предоставьте боту следующие права администратора:
   - ✅ Ban users (Блокировка пользователей)
   - ✅ Add new admins (Необязательно, но рекомендуется)

### Шаг 4: Включите отслеживание изменений участников

В настройках приватности канала убедитесь, что бот может видеть изменения участников. Это обычно включено по умолчанию для ботов-администраторов.

## Запуск бота

```bash
python bot.py
```

Или в фоновом режиме:

```bash
nohup python bot.py &
```

Бот начнет работу и будет логировать все действия в файл `bot.log` и в консоль.

## Команды бота

- `/start` - Проверить, что бот работает
- `/stats` - Показать статистику работы бота

## Логирование

Бот создает файл `bot.log` с подробной информацией о:
- Запуске бота
- Заблокированных пользователях
- Изменениях статусов участников
- Ошибках

Пример записи в логе:
```
2025-10-25 10:30:45 - __main__ - INFO - Пользователь заблокирован: Иван Иванов (ID: 123456789, Username: @ivan) | Старый статус: member -> Новый статус: left
```

## Как это работает

1. Бот использует Telegram Bot API для получения обновлений о подписках на канал (ChatMember updates)
2. Когда статус пользователя меняется с `member` (подписан) на `left` (отписался), бот:
   - Проверяет, что это не бот
   - Блокирует пользователя в канале с помощью `ban_chat_member`
   - Логирует действие

3. Заблокированный пользователь не сможет снова подписаться на канал без разблокировки администратором

**Примечание:** Для работы бота в канале необходимо, чтобы:
- Бот был добавлен как администратор канала
- У бота были права на блокировку пользователей
- Канал позволял боту получать обновления о подписчиках

## Устранение проблем

### Бот не блокирует пользователей

1. Убедитесь, что бот добавлен как администратор с правом "Ban users"
2. Проверьте, что `CHANNEL_ID` указан правильно (должен начинаться с `-100`)
3. Проверьте логи на наличие ошибок

### Бот не запускается

1. Убедитесь, что установлены все зависимости: `pip install -r requirements.txt`
2. Проверьте правильность `BOT_TOKEN` в `.env`
3. Убедитесь, что файл `.env` находится в той же директории, что и `bot.py`

### Бот не видит отписки пользователей

1. Убедитесь, что при создании `Application` используется параметр `allowed_updates=Update.ALL_TYPES`
2. Проверьте, что бот является администратором канала
3. **Важно для каналов:** В некоторых случаях Telegram API может не присылать обновления о подписчиках в больших публичных каналах. Бот лучше всего работает с приватными каналами и каналами среднего размера.

### Канал vs Группа

Этот бот предназначен для **каналов**, а не для групп. Если вам нужен бот для группы:
- **Канал** - пользователи подписываются и читают, только админы публикуют
- **Группа** - пользователи общаются между собой

Текущая реализация работает для обоих типов, но оптимизирована именно для каналов.

## Безопасность

- **НИКОГДА** не коммитьте файл `.env` в Git
- Держите ваш `BOT_TOKEN` в секрете
- Регулярно проверяйте логи на подозрительную активность
- Используйте бота только для легитимных целей модерации

## Лицензия

MIT

## Вклад в проект

Pull requests приветствуются! Для крупных изменений сначала откройте issue для обсуждения.

## Поддержка

Если у вас возникли проблемы или вопросы, создайте issue в репозитории.
